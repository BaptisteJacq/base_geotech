create or replace FUNCTION GET_CODE_INSEE_CONTAIN_POINT(v_geometry SDO_GEOMETRY) RETURN CHAR
/*
Cette fonction a pour objectif de récupérer le code INSEE de la commune dans laquelle se situe un objet ponctuel.
ATTENTION : cette fonction porte sur la vue des 95 communes.
La variable v_table_name doit contenir le nom de la table contenant les objets ponctuels.
La variable v_geometry doit contenir le nom du champ géométrique de la table interrogée.
*/
    DETERMINISTIC
    As
    v_code_insee CHAR(8);
    BEGIN
        SELECT
            TRIM(b.code_insee)
            INTO v_code_insee
        FROM
            G_REFERENTIEL.MEL_COMMUNE b
        WHERE
            SDO_RELATE(v_geometry, b.geom, 'mask=INSIDE')='TRUE';
        RETURN v_code_insee;
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            RETURN 'error';
    END GET_CODE_INSEE_CONTAIN_POINT;

/

/*
SEQ_TA_GEOTECH_FAMILLE_OBJECTID : création de la séquence d'auto-incrémentation de la clé primaire de la table TA_GEOTECH_FAMILLE
*/

CREATE SEQUENCE SEQ_TA_GEOTECH_FAMILLE_OBJECTID START WITH 1 INCREMENT BY 1;

/

/*
TA_GEOTECH_FAMILLE : Création de la table TA_GEOTECH_FAMILLE qui contient les familles des objets liées aux études géotechniques.
*/

-- 1. La table
CREATE TABLE G_GEOTECH.TA_GEOTECH_FAMILLE (
	"OBJECTID" NUMBER(38,0) DEFAULT G_GEOTECH.SEQ_TA_GEOTECH_FAMILLE_OBJECTID.NEXTVAL NOT NULL,
	"VALEUR" VARCHAR2(255 BYTE)
 );

-- 2. Les commentaires
 COMMENT ON TABLE G_GEOTECH.TA_GEOTECH_FAMILLE IS 'Table contenant les familles de libellés permettant de qualifier les objets du schéma G_GEOTECHTECH.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_FAMILLE.OBJECTID IS 'Identifiant de chaque famille de libellés.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_FAMILLE.VALEUR IS 'Valeur de chaque famille de libellés.';

-- 3. Les contraintes
-- Contrainte de clé primaire
ALTER TABLE G_GEOTECH.TA_GEOTECH_FAMILLE
ADD CONSTRAINT TA_GEOTECH_FAMILLE_PK
PRIMARY KEY("OBJECTID")
USING INDEX TABLESPACE G_ADT_INDX;

-- Contraintes d'unicité
ALTER TABLE G_GEOTECH.TA_GEOTECH_FAMILLE
ADD CONSTRAINT TA_GEOTECH_FAMILLE_LIBELLE_UN
UNIQUE("VALEUR")
USING INDEX TABLESPACE G_ADT_INDX;

-- 5. Les droits de lecture, écriture, suppression
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_FAMILLE TO G_ADMIN_SIG;

/

/*
SEQ_TA_GEOTECH_LIBELLE_OBJECTID : création de la séquence d'auto-incrémentation de la clé primaire de la table TA_GEOTECH_LIBELLE
*/

CREATE SEQUENCE SEQ_TA_GEOTECH_LIBELLE_OBJECTID START WITH 1 INCREMENT BY 1;

/

/*
TA_GEOTECH_LIBELLE : Création de la table TA_GEOTECH_LIBELLE qui contient les libellés des objets liées aux études géotechniques.
*/

-- 1. La table
CREATE TABLE G_GEOTECH.TA_GEOTECH_LIBELLE (
	"OBJECTID" NUMBER(38,0) DEFAULT G_GEOTECH.SEQ_TA_GEOTECH_LIBELLE_OBJECTID.NEXTVAL NOT NULL,
	"LIBELLE_LONG" VARCHAR2(4000),
	"LIBELLE_COURT" VARCHAR2(200)
 );

-- 2. Les commentaires
COMMENT ON TABLE G_GEOTECH.TA_GEOTECH_LIBELLE IS 'Table regroupant les libellés long qualifiant les objets de la base G_GEOTECHTECH.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_LIBELLE.OBJECTID IS 'Identifiant de chaque famille de libellés.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_LIBELLE.LIBELLE_LONG IS 'Valeur décrivant les types d''objets répartis par famille.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_LIBELLE.LIBELLE_COURT IS 'Valeur synthétique décrivant les types d''objets répartis par famille. Cette valeur a la même utilité que celle du champ libelle_long, elle est simplement plus courte.';
-- 3. Les contraintes
-- Contrainte de clé primaire
ALTER TABLE G_GEOTECH.TA_GEOTECH_LIBELLE
ADD CONSTRAINT TA_GEOTECH_LIBELLE_PK
PRIMARY KEY("OBJECTID")
USING INDEX TABLESPACE G_ADT_INDX;

-- Contraintes d'unicité
ALTER TABLE G_GEOTECH.TA_GEOTECH_LIBELLE
ADD CONSTRAINT TA_GEOTECH_LIBELLE_LIBELLE_LONG_UN
UNIQUE("LIBELLE_LONG")
USING INDEX TABLESPACE G_ADT_INDX;

ALTER TABLE G_GEOTECH.TA_GEOTECH_LIBELLE
ADD CONSTRAINT TA_GEOTECH_LIBELLE_LIBELLE_COURT_UN
UNIQUE("LIBELLE_COURT")
USING INDEX TABLESPACE G_ADT_INDX;

-- 4. Les droits de lecture, écriture, suppression
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_LIBELLE TO G_ADMIN_SIG;

/

/*
TA_GEOTECH_FAMILLE_LIBELLE : Création de la table TA_GEOTECH_FAMILLE_LIBELLE contenant les identifiant des tables TA_GEOTECH_LIBELLE et TA_GEOTECH_FAMILLE, permettant de joindre chaque libellé à sa famille de libellés.
*/

-- 1. La table
CREATE TABLE G_GEOTECH.TA_GEOTECH_FAMILLE_LIBELLE (
	"OBJECTID" NUMBER(38,0) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
	"FID_FAMILLE" NUMBER(38,0),
	"FID_LIBELLE" NUMBER(38,0)
 );

-- 2. Les commentaires
COMMENT ON TABLE G_GEOTECH.TA_GEOTECH_FAMILLE_LIBELLE IS 'Table contenant les identifiant des tables TA_GEOTECH_FAMILLE_LIBELLE et TA_GEOTECH_FAMILLE, permettant de joindre chaque libellé à sa famille de libellés.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_FAMILLE_LIBELLE.OBJECTID IS 'Clé primaire auto-incrémentée de la table.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_FAMILLE_LIBELLE.FID_FAMILLE IS 'Clé étrangère vers la table TA_GEOTECH_FAMILLE permettant d''associer une famille à un ou plusieurs libellés.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_FAMILLE_LIBELLE.FID_LIBELLE IS 'Clé étrangère vers la table TA_GEOTECH_LIBELLE permettant d''associer un libellé à une ou plusieurs familles.';

-- 3. Les contraintes
-- Contrainte de clé primaire
ALTER TABLE G_GEOTECH.TA_GEOTECH_FAMILLE_LIBELLE
ADD CONSTRAINT TA_GEOTECH_FAMILLE_LIBELLE_PK
PRIMARY KEY("OBJECTID")
USING INDEX TABLESPACE G_ADT_INDX;

-- 5. Les droits de lecture, écriture, suppression
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_FAMILLE_LIBELLE TO G_ADMIN_SIG;

/

/*
SEQ_TA_GEOTECH_SITE_OBJECTID : création de la séquence d'auto-incrémentation de la clé primaire de la table TA_GEOTECH_SITE
*/

CREATE SEQUENCE SEQ_TA_GEOTECH_SITE_OBJECTID START WITH 1 INCREMENT BY 1;

/

/*
TA_GEOTECH_SITE : Création de la table TA_GEOTECH_SITE regroupant tous les sites géotechniques.
*/

-- 1. La table
CREATE TABLE G_GEOTECH.TA_GEOTECH_SITE (
    "OBJECTID" NUMBER(38,0) DEFAULT G_GEOTECH.SEQ_TA_GEOTECH_SITE_OBJECTID.NEXTVAL NOT NULL,
    "GEOM" MDSYS.SDO_GEOMETRY,
    "CODE_INSEE" AS (TRIM(GET_CODE_INSEE_CONTAIN_POINT(geom))),
    "X_EPSG2154" AS (ROUND(GEOM.SDO_POINT.X,6)),
    "Y_EPSG2154" AS (ROUND(GEOM.SDO_POINT.Y,6)),
    "DESCRIPTION" VARCHAR2(4000),
    "ADRESSE" VARCHAR2(4000)
 );

-- 2. Les commentaires
COMMENT ON TABLE G_GEOTECH.TA_GEOTECH_SITE IS 'Table  regroupant tous les sites géotechniques.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_SITE.OBJECTID IS 'Clé primaire auto-incrémentée de la table.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_SITE.GEOM IS 'Champ géométrique de type ponctuel de chaque site.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_SITE.CODE_INSEE IS 'Champ calculé, récupérant via une requête spatiale, le code INSEE de la commune d''appartenance de chaque site.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_SITE.X_EPSG2154 IS 'Champ calculé récupérant les coordonnées en X de chaque site en Lambert93/RGF-93.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_SITE.Y_EPSG2154 IS 'Champ calculé récupérant les coordonnées en Y de chaque site en Lambert93/RGF-93.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_SITE.DESCRIPTION IS 'Description des études auxquelles chaque site est lié.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_SITE.ADRESSE IS 'Adresse de chaque site.';

-- 3. Les métadonnées spatiales
INSERT INTO USER_SDO_GEOM_METADATA(
    TABLE_NAME, 
    COLUMN_NAME, 
    DIMINFO, 
    SRID
)
VALUES(
    'TA_GEOTECH_SITE',
    'GEOM',
    SDO_DIM_ARRAY(SDO_DIM_ELEMENT('X', 684540, 719822.2, 0.005),SDO_DIM_ELEMENT('Y', 7044212, 7078072, 0.005)), 
    2154
);
COMMIT;

-- 3. Les contraintes
-- Contrainte de clé primaire
ALTER TABLE G_GEOTECH.TA_GEOTECH_SITE
ADD CONSTRAINT TA_GEOTECH_SITE_PK
PRIMARY KEY("OBJECTID")
USING INDEX TABLESPACE G_ADT_INDX;

-- 4. Les index
-- Index spatial
CREATE INDEX TA_GEOTECH_SITE_SIDX
ON G_GEOTECH.TA_GEOTECH_SITE(GEOM)
INDEXTYPE IS MDSYS.SPATIAL_INDEX_V2
PARAMETERS('sdo_indx_dims=2, layer_gtype=POINT, tablespace=G_ADT_INDX, work_tablespace=DATA_TEMP');

-- Autres index
CREATE INDEX TA_GEOTECH_SITE_CODE_INSEE_IDX ON G_GEOTECH.TA_GEOTECH_SITE("CODE_INSEE")
    TABLESPACE G_ADT_INDX;

CREATE INDEX TA_GEOTECH_SITE_X_EPSG2154_IDX ON G_GEOTECH.TA_GEOTECH_SITE("X_EPSG2154")
    TABLESPACE G_ADT_INDX;

CREATE INDEX TA_GEOTECH_SITE_Y_EPSG2154_IDX ON G_GEOTECH.TA_GEOTECH_SITE("Y_EPSG2154")
    TABLESPACE G_ADT_INDX;

CREATE INDEX TA_GEOTECH_SITE_ADRESSE_IDX ON G_GEOTECH.TA_GEOTECH_SITE("ADRESSE")
    TABLESPACE G_ADT_INDX;

CREATE INDEX TA_GEOTECH_SITE_DESCRIPTION_IDX ON G_GEOTECH.TA_GEOTECH_SITE("DESCRIPTION")
    TABLESPACE G_ADT_INDX;

-- 5. Les droits de lecture, écriture, suppression
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_SITE TO G_ADMIN_SIG;

/

/*
SEQ_TA_GEOTECH_ETUDE_OBJECTID : création de la séquence d'auto-incrémentation de la clé primaire de la table TA_GEOTECH_ETUDE
*/

CREATE SEQUENCE SEQ_TA_GEOTECH_ETUDE_OBJECTID START WITH 1 INCREMENT BY 1;

/

/*
TA_GEOTECH_ETUDE : Création de la table TA_GEOTECH_ETUDE regroupant toutes les études faites à partir de sites géotechniques.
*/

-- 1. La table
CREATE TABLE G_GEOTECH.TA_GEOTECH_ETUDE (
	"OBJECTID" NUMBER(38,0) DEFAULT G_GEOTECH.SEQ_TA_GEOTECH_ETUDE_OBJECTID.NEXTVAL NOT NULL,
	"REFERENCE_INTERNE" VARCHAR2(4000),
	"DATE_DEBUT" NUMBER(4,0),
	"DATE_FIN" NUMBER(4,0),
	"FID_TYPE_ETUDE" NUMBER(38,0),
	"FID_SITE" NUMBER(38,0)
 );

-- 2. Les commentaires
COMMENT ON TABLE G_GEOTECH.TA_GEOTECH_ETUDE IS 'Table regroupant toutes les études faites à partir de sites géotechniques.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_ETUDE.OBJECTID IS 'Clé primaire auto-incrémentée de la table.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_ETUDE.REFERENCE_INTERNE IS 'Référence interne de chaque étude.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_ETUDE.DATE_DEBUT IS 'Champ contenant l''année de début de l''étude.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_ETUDE.DATE_FIN IS 'Champ contenant l''année de fin de l''étude.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_ETUDE.FID_TYPE_ETUDE IS 'Clé étrangère vers la table TA_GEOTECH_libelle permettant d''associer un type à une étude.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_ETUDE.FID_SITE IS 'Clé étrangère vers la table TA_GEOTECH_SITE permettant d''affecter un site à une étude.';

-- 3. Les contraintes
-- Contrainte de clé primaire
ALTER TABLE G_GEOTECH.TA_GEOTECH_ETUDE
ADD CONSTRAINT TA_GEOTECH_ETUDE_PK
PRIMARY KEY("OBJECTID")
USING INDEX TABLESPACE G_ADT_INDX;

-- Contrainte de clé étrangère
ALTER TABLE G_GEOTECH.TA_GEOTECH_ETUDE
ADD CONSTRAINT TA_GEOTECH_ETUDE_FID_TYPE_ETUDE_FK
FOREIGN KEY("FID_TYPE_ETUDE")
REFERENCES G_GEOTECH.TA_GEOTECH_LIBELLE("OBJECTID");

ALTER TABLE G_GEOTECH.TA_GEOTECH_ETUDE
ADD CONSTRAINT TA_GEOTECH_ETUDE_FID_SITE_FK
FOREIGN KEY("FID_SITE")
REFERENCES G_GEOTECH.TA_GEOTECH_SITE("OBJECTID")
ON DELETE CASCADE;

-- 4. Les index
CREATE INDEX TA_GEOTECH_ETUDE_DATE_DEBUT_IDX ON G_GEOTECH.TA_GEOTECH_ETUDE("DATE_DEBUT")
    TABLESPACE G_ADT_INDX;

CREATE INDEX TA_GEOTECH_ETUDE_DATE_FIN_IDX ON G_GEOTECH.TA_GEOTECH_ETUDE("DATE_FIN")
    TABLESPACE G_ADT_INDX;

CREATE INDEX TA_GEOTECH_ETUDE_FID_TYPE_ETUDE_IDX ON G_GEOTECH.TA_GEOTECH_ETUDE("FID_TYPE_ETUDE")
    TABLESPACE G_ADT_INDX;

CREATE INDEX TA_GEOTECH_ETUDE_REFERENCE_INTERNE_IDX ON G_GEOTECH.TA_GEOTECH_ETUDE("REFERENCE_INTERNE")
    TABLESPACE G_ADT_INDX;

CREATE INDEX TA_GEOTECH_ETUDE_FID_SITE_IDX ON G_GEOTECH.TA_GEOTECH_ETUDE("FID_SITE")
    TABLESPACE G_ADT_INDX;

-- 5. Les droits de lecture, écriture, suppression
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_ETUDE TO G_ADMIN_SIG;

/

/*
SEQ_TA_GEOTECH_BUREAU_ETUDE_OBJECTID : création de la séquence d'auto-incrémentation de la clé primaire de la table TA_GEOTECH_BUREAU_ETUDE
*/

CREATE SEQUENCE SEQ_TA_GEOTECH_BUREAU_ETUDE_OBJECTID START WITH 1 INCREMENT BY 1;

/

/*
TA_GEOTECH_BUREAU_ETUDE : Création de la table TA_GEOTECH_BUREAU_ETUDE permettant de lier chaque étude à un ou plusieurs bureaux d''étude.
*/

-- 1. La table
CREATE TABLE G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE (
	"OBJECTID" NUMBER(38,0) DEFAULT G_GEOTECH.SEQ_TA_GEOTECH_BUREAU_ETUDE_OBJECTID.NEXTVAL NOT NULL,
	"NOM" VARCHAR2(300),
	"FID_ETUDE" NUMBER(38,0)
 );

-- 2. Les commentaires
COMMENT ON TABLE G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE IS 'Table permettant de lier chaque étude à un ou plusieurs bureaux d''étude.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE.OBJECTID IS 'Clé primaire auto-incrémentée de la table.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE.NOM IS 'Nom du bureau d''étude.';
COMMENT ON COLUMN G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE.FID_ETUDE IS 'Clé étrangère vers la table TA_GEOTECH_ETUDE permettant d''associer une étude à un ou plusieurs bureaux d''étude.';

-- 3. Les contraintes
-- Contrainte de clé primaire
ALTER TABLE G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE
ADD CONSTRAINT TA_GEOTECH_BUREAU_ETUDE_PK
PRIMARY KEY("OBJECTID")
USING INDEX TABLESPACE G_ADT_INDX;

-- Contrainte de clé étrangère
ALTER TABLE G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE
ADD CONSTRAINT TA_GEOTECH_BUREAU_ETUDE_FID_ETUDE_FK
FOREIGN KEY("FID_ETUDE")
REFERENCES G_GEOTECH.TA_GEOTECH_ETUDE("OBJECTID")
ON DELETE CASCADE;

-- 4. Les index
CREATE INDEX TA_GEOTECH_BUREAU_ETUDE_NOM_IDX ON G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE("NOM")
    TABLESPACE G_ADT_INDX;

CREATE INDEX TA_GEOTECH_BUREAU_ETUDE_FID_ETUDE_IDX ON G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE("FID_ETUDE")
    TABLESPACE G_ADT_INDX;

-- 5. Les droits de lecture, écriture, suppression
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE TO G_ADMIN_SIG;

/

/*
Création de la vue V_GEOTECH_VISUALISATION_SITE_ETUDE permettant de visualiser toutes les informations de chaque étude géotechnique
*/

-- 1. Création de la vue
CREATE OR REPLACE FORCE EDITIONABLE VIEW "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE" ("OBJECTID", "ID_SITE", "DESCRIPTION_ETUDE", "ADRESSE_SITE", "INSEE_SITE", "X_EPSG2154", "Y_EPSG2154", "REFERENCE_INTERNE_ETUDE", "TYPE_ETUDE_LONG", "TYPE_ETUDE_COURT", "DATE_DEBUT_ETUDE", "DATE_FIN_ETUDE", "NOM_BUREAU_ETUDE", "GEOM", 
     CONSTRAINT "V_GEOTECH_VISUALISATION_SITE_ETUDE_PK" PRIMARY KEY ("OBJECTID") DISABLE) AS 
    WITH
        C_1 AS(
            SELECT
                c.objectid AS id_etude,
                c.fid_site,
                c.reference_interne AS reference_interne_etude,
                d.libelle_long AS type_etude_long,
                d.libelle_court AS type_etude_court,
                c.date_debut AS date_debut_etude,
                c.date_fin AS date_fin_etude,
                LISTAGG(e.nom, ' ; ') WITHIN GROUP (ORDER BY c.objectid) AS bureau_etude
            FROM
                G_GEOTECH.TA_GEOTECH_SITE a
                INNER JOIN G_GEOTECH.TA_GEOTECH_ETUDE c ON c.fid_site = a.objectid
                INNER JOIN G_GEOTECH.TA_GEOTECH_LIBELLE d ON d.objectid = c.fid_type_etude
                INNER JOIN G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE e ON e.fid_etude = c.objectid
            GROUP BY
                c.objectid,
                c.fid_site,
                c.reference_interne,
                d.libelle_long,
                d.libelle_court,
                c.date_debut,
                c.date_fin
        )
        
    SELECT
        rownum,
        a.objectid,
        a.description,
        a.adresse,
        GET_CODE_INSEE_CONTAIN_POINT(a.geom),
        a.x_epsg2154,
        a.y_epsg2154,
        d.reference_interne_etude,
        d.type_etude_long,
        d.type_etude_court,
        d.date_debut_etude,
        d.date_fin_etude,
        d.bureau_etude,
        a.geom
    FROM
        G_GEOTECH.TA_GEOTECH_SITE a        
        INNER JOIN C_1 d ON d.fid_site = a.objectid;

-- 2. Création des commentaires
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."OBJECTID" IS 'Identifiant de chaque entité de la vue.';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."ID_SITE" IS 'Identifiant de chaque site.';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."DESCRIPTION_ETUDE" IS 'Description des études auxquelles chaque site est lié.';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."ADRESSE_SITE" IS 'Adresse de chaque site.';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."INSEE_SITE" IS 'Code INSEE de la commune d''appartenance de chaque site.';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."X_EPSG2154" IS 'Coordonnées en X de chaque site en Lambert93/RGF-93.';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."Y_EPSG2154" IS 'Coordonnées en Y de chaque site en Lambert93/RGF-93.';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."REFERENCE_INTERNE_ETUDE" IS 'Référence interne de chaque étude.';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."TYPE_ETUDE_LONG" IS 'Type d''étude (libellé long).';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."TYPE_ETUDE_COURT" IS 'Type d''étude (libellé court).';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."DATE_DEBUT_ETUDE" IS 'Année de début de l''étude.';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."DATE_FIN_ETUDE" IS 'Année de fin de l''étude.';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."NOM_BUREAU_ETUDE" IS 'Nom du bureau d''étude ayant réalisé l''étude.';
COMMENT ON COLUMN "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"."GEOM" IS 'Géométrie des sites de type ponctuel.';
COMMENT ON TABLE "G_GEOTECH"."V_GEOTECH_VISUALISATION_SITE_ETUDE"  IS 'Vue proposant les sites, études et bureaux d''étude du projet GEOTECH.';

-- 3. Création des métadonnées spatiales
INSERT INTO USER_SDO_GEOM_METADATA(
    TABLE_NAME, 
    COLUMN_NAME, 
    DIMINFO, 
    SRID
)
VALUES(
    'V_GEOTECH_VISUALISATION_SITE_ETUDE',
    'GEOM',
    SDO_DIM_ARRAY(SDO_DIM_ELEMENT('X', 684540, 719822.2, 0.005),SDO_DIM_ELEMENT('Y', 7044212, 7078072, 0.005)), 
    2154
);
COMMIT;

-- 4. Création des droits de lecture
GRANT SELECT ON G_GEOTECH.V_GEOTECH_VISUALISATION_SITE_ETUDE TO G_ADMIN_SIG;

/

/*
Affectation des droits de lecture, édition et suppression des tables et les séquences du schéma GestionGeo.
*/
-- G_GEOTECHTECH_R :
-- Séquences
GRANT SELECT ON G_GEOTECH.SEQ_TA_GEOTECH_FAMILLE_OBJECTID TO G_GEOTECH_R;
GRANT SELECT ON G_GEOTECH.SEQ_TA_GEOTECH_LIBELLE_OBJECTID TO G_GEOTECH_R;
GRANT SELECT ON G_GEOTECH.SEQ_TA_GEOTECH_ETUDE_OBJECTID TO G_GEOTECH_R;
GRANT SELECT ON G_GEOTECH.SEQ_TA_GEOTECH_BUREAU_ETUDE_OBJECTID TO G_GEOTECH_R;
GRANT SELECT ON G_GEOTECH.SEQ_TA_GEOTECH_SITE_OBJECTID TO G_GEOTECH_R;

-- Tables
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_FAMILLE TO G_GEOTECH_R;
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_LIBELLE TO G_GEOTECH_R;
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_ETUDE TO G_GEOTECH_R;
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_SITE TO G_GEOTECH_R;
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE TO G_GEOTECH_R;
/*
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_REPERTOIRE TO G_GEOTECH_R;
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_FICHIER TO G_GEOTECH_R;
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_ETUDE_LOG TO G_GEOTECH_R;
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_SITE_LOG TO G_GEOTECH_R;
*/

-- Vues
GRANT SELECT ON G_GEOTECH.V_GEOTECH_VISUALISATION_SITE_ETUDE TO G_GEOTECH_R;
--GRANT SELECT ON G_GEOTECH.V_CHEMIN_FICHIER_GEOTECH TO G_GEOTECH_R;

-- G_GEOTECHTECH_RW :
-- Séquences
GRANT SELECT ON G_GEOTECH.SEQ_TA_GEOTECH_FAMILLE_OBJECTID TO G_GEOTECH_RW;
GRANT SELECT ON G_GEOTECH.SEQ_TA_GEOTECH_LIBELLE_OBJECTID TO G_GEOTECH_RW;
GRANT SELECT ON G_GEOTECH.SEQ_TA_GEOTECH_ETUDE_OBJECTID TO G_GEOTECH_RW;
GRANT SELECT ON G_GEOTECH.SEQ_TA_GEOTECH_BUREAU_ETUDE_OBJECTID TO G_GEOTECH_RW;
GRANT SELECT ON G_GEOTECH.SEQ_TA_GEOTECH_SITE_OBJECTID TO G_GEOTECH_RW;

-- Tables
GRANT SELECT, INSERT, UPDATE, DELETE ON G_GEOTECH.TA_GEOTECH_FAMILLE TO G_GEOTECH_RW;
GRANT SELECT, INSERT, UPDATE, DELETE ON G_GEOTECH.TA_GEOTECH_FAMILLE_LIBELLE TO G_GEOTECH_RW;
GRANT SELECT, INSERT, UPDATE, DELETE ON G_GEOTECH.TA_GEOTECH_LIBELLE TO G_GEOTECH_RW;
GRANT SELECT, INSERT, UPDATE, DELETE ON G_GEOTECH.TA_GEOTECH_ETUDE TO G_GEOTECH_RW;
GRANT UPDATE(GEOM) ON G_GEOTECH.TA_GEOTECH_SITE TO G_GEOTECH_RW;
GRANT SELECT, INSERT, UPDATE, DELETE ON G_GEOTECH.TA_GEOTECH_SITE TO G_GEOTECH_RW;
GRANT SELECT, INSERT, UPDATE, DELETE ON G_GEOTECH.TA_GEOTECH_BUREAU_ETUDE TO G_GEOTECH_RW;
/*
GRANT SELECT, INSERT, UPDATE, DELETE ON G_GEOTECH.TA_GEOTECH_REPERTOIRE TO G_GEOTECH_RW;
GRANT SELECT, INSERT, UPDATE, DELETE ON G_GEOTECH.TA_GEOTECH_FICHIER TO G_GEOTECH_RW;
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_ETUDE_LOG TO G_GEOTECH_RW;
GRANT SELECT ON G_GEOTECH.TA_GEOTECH_SITE_LOG TO G_GEOTECH_RW;
*/

-- Vues
GRANT SELECT ON G_GEOTECH.V_GEOTECH_VISUALISATION_SITE_ETUDE TO G_GEOTECH_RW;
--GRANT SELECT ON G_GEOTECH.V_CHEMIN_FICHIER_GEOTECH TO G_GEOTECH_RW;

-- ISOGEO
GRANT SELECT ON G_GEOTECH.V_GEOTECH_VISUALISATION_SITE_ETUDE TO ISOGEO_LEC;

-- GEOSERVER
GRANT SELECT ON G_GEOTECH.V_GEOTECH_VISUALISATION_SITE_ETUDE TO G_SERVICE_WEB;

/

